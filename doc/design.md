# entry-task（用户管理系统)技术设计文档



## 一、背景及目的

  通过实现简单用户管理系统，帮忙团队新人快速熟悉团队的技术栈,希望能达到几个目的:

- 熟悉简单的Web API后台架构
- 熟悉使用Go实现HTTP API（JSON、文件）
- 熟悉使用Go实现基于TCP的RPC框架（设计和实现通信协议）
- 熟悉基于Auth Token的鉴权机制和流程
- 熟悉使用Go对MySQL、Redis进行基本操作
- 对任务进度和时间有所意识
- 对代码规范、测试、文档、性能调优需要有所意识


## 二、逻辑架构设计
![系统框架图](https://github.com/wxquare/enry_task/blob/master/doc/images/1.png)

### 主要模块功能:
- 用户通过浏览器向web server发送http请求，登录请求，查看用户信息、编辑用户信息
- Webserver 接收请求，解析参数，然后构造rpc请求tcpserver
- tcpserver 中系统的主要逻辑，负责查询db、cache鉴权，查询和写用户的信息
- mysql 存储用户的信息，redis 缓存用户信息以及token信息

### 主要接口：
- login：登录接口
- logout：退出登录
- getuserinfo：获取用户信息
- edituserinfo：编辑用户昵称
- uploadpic：上传用户图像


## 三、核心逻辑详细设计

### 1、用户登录的时序图
![用户登录时序图](https://github.com/wxquare/enry_task/blob/master/doc/images/2.png)

### 2、RPC 框架的设计

### 3. 池化 设计

## 4. 存储的淘汰和更新机制


## 四、接口设计
给出对外接口描述，包括名称、地址或URL、类型（GRPC/HTTPS等）、协议内容（PB/JSON等）、各参数（类型、描述、限制）等；

对外接口需要给出鉴权机制和其他安全性考虑；


## 五、存储设计
可包括：
1、数据库表定义、字段定义、索引、主/备库读写等；
2、缓存KV设计、加载/更新/失效逻辑等；



## 七、部署方案与环境要求
可包括：

1、配置初始化、更改、下发、推送等；
2、各种存储容量的预估、需要扩容的实例、备库、账号要求等；
3、接入层、逻辑层实例数；



## 八、遗留问题与风险预估
可包括：
1、本次方案受限于时间、人力、外部因素等原因，未充分设计或者实现，可能带来的影响，以及下阶段的改进计划。
2、受限于外部依赖限制、硬件资源、网络等不可控条件，存在的运行和运营风险。


## 十、附录
可包括一些附带的内容，例如引用的文档链接、提供的操作手册附件等。
